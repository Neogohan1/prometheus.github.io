<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Prometheus monitoring system">
    <meta name="author" content="Prometheus">
    <link rel="icon" href="../../favicon.ico">

    <title>Prometheus</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/bootstrap-3.3.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/docs.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/assets/font-awesome-4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Prometheus</a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
          <ul class="nav navbar-nav navbar-right main-nav">
            <li><a href="/">Overview</a></li>
            <li><a href="/docs/introduction/overview">Documentation</a></li>
            <li><a href="/community">Community</a></li>
            <li><a href="https://github.com/prometheus"><i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div>
      </div>
    </nav>


<div class="container">
  <div class="row">
    <div class="col-md-3">
      <ul class="nav navbar-nav side-nav">
        
          <li><span class="nav-header"><i class="fa fa-hand-o-right"></i> Introduction</span><ul class="nav"><li><a href="/docs/introduction/overview/">Overview</a></li><li><a href="/docs/introduction/install/">Installing</a></li><li><a href="/docs/introduction/getting_started/">Getting started</a></li><li><a href="/docs/introduction/comparison/">Comparison to alternatives</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-flask"></i> Concepts</span><ul class="nav"><li><a href="/docs/concepts/data_model/">Data model</a></li><li><a href="/docs/concepts/metric_types/">Metric types</a></li><li><a href="/docs/concepts/jobs_instances/">Jobs and instances</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-search"></i> Query language</span><ul class="nav"><li><a href="/docs/querying/basics/">Basics</a></li><li><a href="/docs/querying/operators/">Operators</a></li><li><a href="/docs/querying/functions/">Functions</a></li><li><a href="/docs/querying/examples/">Examples</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-line-chart"></i> Visualization</span><ul class="nav"><li><a href="/docs/visualization/browser/">Expression browser</a></li><li><a href="/docs/visualization/promdash/">PromDash</a></li><li><a href="/docs/visualization/consoles/">Console templates</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-cog"></i> Operating</span><ul class="nav"><li><a href="/docs/operating/configuration/">Configuration</a></li><li><a href="/docs/operating/storage/">Storage</a></li><li class="active"><a href="/docs/operating/rules/">Recording and alerting rules</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-code"></i> Instrumenting</span><ul class="nav"><li><a href="/docs/instrumenting/clientlibs/">Client libraries</a></li><li><a href="/docs/instrumenting/exposition_formats/">Exposition formats</a></li><li><a href="/docs/instrumenting/pushing/">Pushing metrics</a></li></ul></li>
        
          <li><span class="nav-header"><i class="fa fa-thumbs-o-up"></i> Best practices</span><ul class="nav"><li><a href="/docs/practices/naming/">Metric and label naming</a></li><li><a href="/docs/practices/instrumentation/">Instrumentation</a></li><li><a href="/docs/practices/consoles/">Consoles and dashboards</a></li><li><a href="/docs/practices/alerting/">Alerting</a></li></ul></li>
        
      </ul>
    </div>

    <div class="col-md-9 doc-content">
      <h1 class="page-header">Defining recording and alerting rules</h1>

<h2>Configuring rules</h2>

<p>Prometheus supports two types of rules which may be configured and then
evaluated at regular intervals: recording rules and alerting rules. To include
rules in Prometheus, create a file containing the necessary rule statements and
have Prometheus load the file via the <code>rule_files</code> field in the <a href="https://github.com/prometheus/prometheus/blob/master/config/config.proto">Prometheus
configuration</a>.</p>

<h2>Syntax-checking rules</h2>

<p>To quickly check whether a rule file is syntactically correct without starting
a Prometheus server, install and run Prometheus' <code>rule_checker</code> tool:</p>

<pre><code class="bash"># If $GOPATH/github.com/prometheus/prometheus already exists, update it first:
go get -u github.com/prometheus/prometheus

go install github.com/prometheus/prometheus/tools/rule_checker
rule_checker -ruleFile=/path/to/example.rules
</code></pre>

<p>When the file is syntactically valid, the checker prints a textual
representation of the parsed rules and then exits with an <code>0</code> return status.</p>

<p>If there are any syntax errors, it prints an error message and exits with a
<code>255</code> return status.</p>

<h2>Recording rules</h2>

<p>Recording rules allow you to precompute frequently needed or computationally
expensive expressions and save their result as a new set of time series.
Querying the precomputed result will then often be much faster than executing
the original expression every time it is needed. This is especially useful for
dashboards, which need to query the same expression repeatedly every time they
refresh.</p>

<p>To add a new recording rule, add a line of the following syntax to your rule
file:</p>

<pre><code>&lt;new time series name&gt;[{&lt;label overrides&gt;}] = &lt;expression to record&gt;
</code></pre>

<p>Some examples:</p>

<pre><code>// Saving the per-job HTTP in-progress request count as a new set of timeseries:
job:http_inprogress_requests:sum = sum(http_inprogress_requests) by (job)

// Drop or rewrite labels in the result time series:
new_time series{label_to_change="new_value",label_to_drop=""} = old_time series
</code></pre>

<p>Recording rules are evaluated at the interval specified by the
<code>evaluation_interval</code> field in the Prometheus configuration. During each
evaluation cycle, the right-hand-side expression of the rule statement is
evaluated at the current instant in time and the resulting sample vector is
stored as a new set of time series with the current timestamp and a new metric
name (and perhaps an overridden set of labels).</p>

<h2>Alerting rules</h2>

<p>Alerting rules allow you to define alert conditions based on Prometheus
expression language expressions and to send notifications about firing alerts
to an external service. Whenever the alert expression results in one or more
vector elements at a given point in time, the alert counts as active for these
elements' label sets.</p>

<h3>Defining alerting rules</h3>

<p>Alerting rules are defined in the following syntax:</p>

<pre><code>ALERT &lt;alert name&gt;
  IF &lt;expression&gt;
  [FOR &lt;duration&gt;]
  WITH &lt;label set&gt;
  SUMMARY "&lt;summary template&gt;"
  DESCRIPTION "&lt;description template&gt;"
</code></pre>

<p>The optional <code>FOR</code> clause causes Prometheus to wait for a certain duration
between first encountering a new expression output vector element (like an
instance with a high HTTP error rate) and counting an alert as firing for this
element. Elements that are active, but not firing yet, are in pending state.</p>

<p>The <code>WITH</code> clause allows specifying a set of additional labels to be attached
to the alert. Any existing conflicting labels will be overwritten.</p>

<p>The <code>SUMMARY</code> should be a short, human-readable summary of the alert (suitable
for e.g. an email subject line), while the <code>DESCRIPTION</code> clause should provide
a longer description. Both string fields allow the inclusion of template
variables derived from the firing vector elements of the alert:</p>

<pre><code>// To insert a firing element's label values:
{{$labels.&lt;labelname&gt;}}
// To insert the numeric expression value of the firing element:
{{$value}}
</code></pre>

<p>Examples:</p>

<pre><code>// Alert for any instance that is unreachable for &gt;5 minutes.
ALERT InstanceDown
  IF up == 0
  FOR 5m
  WITH {
    severity="page"
  }
  SUMMARY "Instance {{$labels.instance}} down"
  DESCRIPTION "{{$labels.instance}} of job {{$labels.job}} has been down for more than 5 minutes."

// Alert for any instance that have a median request latency &gt;1s.
ALERT ApiHighRequestLatency
  IF api_http_request_latencies_ms{quantile="0.5"} &gt; 1000
  FOR 1m
  WITH {}
  SUMMARY "High request latency on {{$labels.instance}}"
  DESCRIPTION "{{$labels.instance}} has a median request latency above 1s (current value: {{$value}})"
</code></pre>

<h3>Inspecting alerts during runtime</h3>

<p>To manually inspect which alerts are active (pending or firing), navigate to
the "Alerts" tab of your Prometheus instance. This will show you the exact
label sets for which each defined alert is currently active.</p>

<h3>Sending alert notifications</h3>

<p>Prometheus's alerting rules are good at figuring what is broken <em>right now</em>,
but they are not a fully-fledged notification solution. Another layer is needed
to add summarization, notification rate limiting, silencing and alert
dependencies on top of the simple alert definitions. In Prometheus' ecosystem,
the <a href="http://github.com/prometheus/alertmanager">Alert Manager</a> takes on this
role. Thus, Prometheus may be configured to periodically send information about
alert states to an Alert Manager instance, which then takes care of dispatching
the right notifications. The Alert Manager instance may be configured via the
<code>-alertmanager.url</code> command line flag.</p>

    </div>

  </div>
  <hr>

<footer>
  <p class="pull-left">
    &copy; Prometheus Authors 2015
  </p>
  <p class="pull-right">
    Sponsored by <a href="http://soundcloud.com/" class="sc-logo" title="Go to SoundCloud.com"><i class="fa fa-soundcloud"></i> SoundCloud</a>
  </p>
</footer>

</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/assets/bootstrap-3.3.1/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/assets/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>

